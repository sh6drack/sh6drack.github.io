<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="theme-color" content="#030305">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="icon" type="image/png" href="favicon.png">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">
  <title>POLARITY - 3D</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;500;700;900&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

    html, body {
      width: 100%; height: 100%;
      overflow: hidden;
      font-family: 'Inter', -apple-system, sans-serif;
      background: #030305;
      color: #fff;
      -webkit-font-smoothing: antialiased;
    }

    #canvas {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      touch-action: pan-x pan-y;
    }

    .header {
      position: fixed;
      top: 0; left: 0; right: 0;
      padding: max(16px, env(safe-area-inset-top)) max(20px, env(safe-area-inset-right)) 16px max(20px, env(safe-area-inset-left));
      display: flex;
      align-items: center;
      gap: 12px;
      z-index: 100;
      pointer-events: none;
    }

    .header img {
      width: 32px; height: 32px;
    }

    .header span {
      font-weight: 700;
      font-size: 13px;
      letter-spacing: 0.15em;
      opacity: 0.8;
    }

    .hint {
      position: fixed;
      bottom: 50%;
      left: 50%;
      transform: translate(-50%, 50%);
      font-size: 14px;
      font-weight: 300;
      letter-spacing: 0.05em;
      opacity: 0;
      pointer-events: none;
      z-index: 50;
      transition: opacity 0.6s;
      text-align: center;
      padding: 16px 28px;
      background: rgba(0,0,0,0.7);
      border-radius: 40px;
      border: 1px solid rgba(255,255,255,0.1);
    }

    .hint.show { opacity: 0.9; }

    .cta {
      position: fixed;
      bottom: max(24px, env(safe-area-inset-bottom));
      right: max(24px, env(safe-area-inset-right));
      z-index: 100;
    }

    .cta button {
      background: #4ECDC4;
      border: none;
      border-radius: 50px;
      padding: 18px 32px;
      font-size: 13px;
      font-weight: 600;
      color: #000;
      font-family: inherit;
      letter-spacing: 0.08em;
      cursor: pointer;
      box-shadow: 0 6px 30px rgba(78, 205, 196, 0.4);
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .cta button:active {
      transform: scale(0.95);
    }

    .panel {
      position: fixed;
      bottom: 0; left: 0; right: 0;
      background: rgba(8,8,12,0.98);
      border-top: 1px solid rgba(255,255,255,0.08);
      padding: 28px;
      padding-bottom: max(28px, calc(env(safe-area-inset-bottom) + 16px));
      transform: translateY(100%);
      transition: transform 0.4s cubic-bezier(0.32, 0.72, 0, 1);
      z-index: 200;
      max-height: 65vh;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }

    .panel.open { transform: translateY(0); }

    .panel-head {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 14px;
    }

    .panel-cat {
      font-size: 10px;
      font-weight: 500;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      opacity: 0.4;
      margin-bottom: 6px;
    }

    .panel-title {
      font-size: 26px;
      font-weight: 900;
      letter-spacing: -0.02em;
      line-height: 1.15;
    }

    .panel-close {
      width: 44px; height: 44px;
      background: rgba(255,255,255,0.06);
      border: none;
      border-radius: 50%;
      color: #fff;
      font-size: 22px;
      cursor: pointer;
      flex-shrink: 0;
      margin-left: 16px;
    }

    .panel-desc {
      font-size: 15px;
      font-weight: 300;
      line-height: 1.7;
      opacity: 0.7;
    }

    .panel-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 18px;
    }

    .panel-tag {
      font-size: 11px;
      font-weight: 500;
      letter-spacing: 0.03em;
      padding: 8px 14px;
      background: rgba(255,255,255,0.06);
      border-radius: 20px;
    }

    .modal {
      position: fixed;
      inset: 0;
      background: rgba(3,3,5,0.95);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s;
      z-index: 500;
      padding: max(24px, env(safe-area-inset-top)) 24px max(24px, env(safe-area-inset-bottom));
    }

    .modal.open { opacity: 1; visibility: visible; }

    .modal-box {
      background: rgba(12,12,18,0.98);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 24px;
      padding: 36px 28px;
      max-width: 380px;
      width: 100%;
      text-align: center;
      position: relative;
    }

    .modal h2 {
      font-size: 24px;
      font-weight: 900;
      margin-bottom: 6px;
    }

    .modal p {
      font-size: 14px;
      font-weight: 300;
      opacity: 0.5;
      margin-bottom: 28px;
    }

    .modal form {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .modal input {
      width: 100%;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 14px;
      padding: 16px 20px;
      font-size: 16px;
      color: #fff;
      font-family: inherit;
      outline: none;
    }

    .modal input:focus {
      border-color: rgba(78,205,196,0.6);
    }

    .modal input::placeholder { color: rgba(255,255,255,0.3); }

    .modal button[type="submit"] {
      background: #4ECDC4;
      border: none;
      border-radius: 14px;
      padding: 16px;
      font-size: 14px;
      font-weight: 600;
      color: #000;
      font-family: inherit;
      letter-spacing: 0.06em;
      cursor: pointer;
    }

    .modal .x {
      position: absolute;
      top: 12px; right: 12px;
      width: 44px; height: 44px;
      background: none;
      border: none;
      color: #fff;
      font-size: 26px;
      cursor: pointer;
      opacity: 0.4;
    }

    .msg {
      margin-top: 16px;
      font-size: 14px;
      min-height: 20px;
    }

    @media (min-width: 600px) {
      .modal form { flex-direction: row; }
      .modal input { flex: 1; }
      .modal button[type="submit"] { padding: 16px 28px; }
      .panel { padding: 36px; }
      .panel-title { font-size: 32px; }
    }
  </style>
</head>
<body>

<canvas id="canvas"></canvas>

<div class="header">
  <img src="icon.svg" alt="">
  <span>POLARITY</span>
</div>

<div class="hint" id="hint">Tap a node to explore</div>

<div class="cta">
  <button id="cta">WAITLIST</button>
</div>

<div class="panel" id="panel">
  <div class="panel-head">
    <div>
      <div class="panel-cat" id="pCat"></div>
      <div class="panel-title" id="pTitle"></div>
    </div>
    <button class="panel-close" id="pClose">×</button>
  </div>
  <div class="panel-desc" id="pDesc"></div>
  <div class="panel-tags" id="pTags"></div>
</div>

<div class="modal" id="modal">
  <div class="modal-box">
    <button class="x" id="mx">×</button>
    <h2>Join the Waitlist</h2>
    <p>Be the first to map your mind</p>
    <form id="form">
      <input type="email" name="email" placeholder="you@email.com" required autocomplete="email">
      <button type="submit">JOIN</button>
    </form>
    <div class="msg" id="msg"></div>
  </div>
</div>

<script>
// Data
const nodes = [
  { id:'core', label:'POLARITY', cat:'Core', title:'Your AI Exocortex',
    desc:'A 3D neural knowledge graph mapping your mind to anatomically accurate brain regions. Talk naturally—Polarity extracts what you know.',
    tags:['3D Brain','Knowledge Graph','Claude AI'], color:[78,205,196], r:1.5 },
  { id:'brain', label:'BRAINID', cat:'Identity', title:'Cognitive Identity',
    desc:'20 nodes unlock your unique identifier. Your knowledge graph becomes your credential—a fingerprint that evolves with you.',
    tags:['Threshold','Portable','Evolving'], color:[78,205,196], r:0.7 },
  { id:'auth', label:'AUTH', cat:'Security', title:'Brain as Password',
    desc:'Challenge-response from graph pathways. NBKDF key derivation. AES-256-GCM encrypted .polarity files.',
    tags:['NBKDF','Encrypted'], color:[187,143,206], r:0.65 },
  { id:'time', label:'TIME', cat:'Temporal', title:'Git for Your Mind',
    desc:'Snapshots at midnight. Travel to any date. See exactly what changed in your knowledge.',
    tags:['Snapshots','History'], color:[255,160,122], r:0.6 },
  { id:'future', label:'FUTURE', cat:'Projection', title:'Chat with Tomorrow',
    desc:'Set a target date. AI generates projected knowledge. Chat with who you\'ll become.',
    tags:['Timelines','Goals'], color:[78,205,196], r:0.65 },
  { id:'traits', label:'TRAITS', cat:'Psychology', title:'Pattern Detection',
    desc:'Personality patterns from conversation. What you emphasize, avoid, how you think.',
    tags:['Personality','Values'], color:[187,143,206], r:0.55 },
  { id:'agent', label:'AGENTS', cat:'Execution', title:'AI Agent Modes',
    desc:'Auto, Ask, or Plan mode. Full IDE integration—code view, file explorer, terminal.',
    tags:['Auto','Ask','Plan'], color:[255,160,122], r:0.6 },
  { id:'cloud', label:'CLOUD', cat:'Sync', title:'Zero-Config Sync',
    desc:'Device-based auth. BrainID verification. Free tier, $15 basic, $50 pro.',
    tags:['Sync','Tiers'], color:[78,205,196], r:0.5 },
  { id:'dual', label:'DUAL', cat:'Meta', title:'AI That Knows Itself',
    desc:'Polarity maintains its own knowledge base. Self-goals for continuous improvement.',
    tags:['Self-Aware','Goals'], color:[255,160,122], r:0.55 }
];

// Setup
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let W, H, cx, cy, scale;
const dpr = Math.min(devicePixelRatio || 1, 2);

function resize() {
  W = innerWidth; H = innerHeight;
  canvas.width = W * dpr; canvas.height = H * dpr;
  canvas.style.width = W + 'px'; canvas.style.height = H + 'px';
  ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
  cx = W / 2; cy = H / 2;
  scale = Math.min(W, H) * 0.35;
}
resize();
addEventListener('resize', resize);

// Positions
const pos = [{ x: 0, y: 0, z: 0 }];
for (let i = 1; i < nodes.length; i++) {
  const a = ((i - 1) / (nodes.length - 1)) * Math.PI * 2;
  const depth = [0, -1.2, -0.8, 1, 1.3, -0.4, 0.7, -0.2, 0.4][i];
  pos.push({ x: Math.cos(a) * 2, y: Math.sin(a) * 1.2, z: depth });
}

// Stars
const stars = Array.from({ length: 150 }, () => ({
  x: (Math.random() - 0.5) * 12,
  y: (Math.random() - 0.5) * 12,
  z: (Math.random() - 0.5) * 12,
  s: 0.3 + Math.random() * 0.8
}));

// State
let rotX = 0.2, rotY = 0;
let tRotX = 0.2, tRotY = 0;
let dragging = false, startX, startY, startRX, startRY;
let auto = true;
let t = 0;

// Project
function proj(x, y, z) {
  const cX = Math.cos(rotX), sX = Math.sin(rotX);
  const cY = Math.cos(rotY), sY = Math.sin(rotY);
  const x1 = x * cY - z * sY;
  const z1 = x * sY + z * cY;
  const y1 = y * cX - z1 * sX;
  const z2 = y * sX + z1 * cX + 5;
  const s = scale / z2;
  return { x: cx + x1 * s, y: cy + y1 * s, s, z: z2 };
}

// Input
function getXY(e) {
  const t = e.touches?.[0];
  return t ? { x: t.clientX, y: t.clientY } : { x: e.clientX, y: e.clientY };
}

function down(e) {
  const p = getXY(e);
  dragging = true;
  startX = p.x; startY = p.y;
  startRX = tRotX; startRY = tRotY;
  auto = false;
}

function move(e) {
  if (!dragging) return;
  const p = getXY(e);
  tRotY = startRY + (p.x - startX) * 0.006;
  tRotX = Math.max(-0.7, Math.min(0.7, startRX + (p.y - startY) * 0.006));
}

function up(e) {
  if (!dragging) return;
  dragging = false;
  const p = getXY(e.changedTouches?.[0] || e);
  if (Math.abs(p.x - startX) + Math.abs(p.y - startY) < 12) tap(p);
}

canvas.onmousedown = down;
canvas.onmousemove = move;
canvas.onmouseup = up;
canvas.onmouseleave = () => dragging = false;
canvas.ontouchstart = e => { e.preventDefault(); down(e); };
canvas.ontouchmove = e => { e.preventDefault(); move(e); };
canvas.ontouchend = up;

// Tap
function tap(p) {
  const projected = nodes.map((n, i) => {
    const o = pos[i];
    const pr = proj(o.x, o.y + (i ? Math.sin(t + i) * 0.02 : 0), o.z);
    return { ...pr, n, i };
  }).sort((a, b) => b.z - a.z);

  for (const pr of projected) {
    const r = Math.max(pr.n.r * pr.s * 0.8, 25);
    if ((p.x - pr.x) ** 2 + (p.y - pr.y) ** 2 < r ** 2) {
      openPanel(pr.n);
      return;
    }
  }
}

// Panel
const panel = document.getElementById('panel');
function openPanel(n) {
  document.getElementById('pCat').textContent = n.cat;
  document.getElementById('pTitle').textContent = n.title;
  document.getElementById('pTitle').style.color = `rgb(${n.color})`;
  document.getElementById('pDesc').textContent = n.desc;
  document.getElementById('pTags').innerHTML = n.tags.map(t => `<span class="panel-tag">${t}</span>`).join('');
  panel.classList.add('open');
  document.getElementById('hint').classList.remove('show');
}
document.getElementById('pClose').onclick = () => panel.classList.remove('open');

// Modal
const modal = document.getElementById('modal');
document.getElementById('cta').onclick = () => modal.classList.add('open');
document.getElementById('mx').onclick = () => modal.classList.remove('open');
modal.onclick = e => { if (e.target === modal) modal.classList.remove('open'); };

// Form
document.getElementById('form').onsubmit = async e => {
  e.preventDefault();
  const email = e.target.email.value;
  const msg = document.getElementById('msg');
  try {
    const r = await fetch('https://formspree.io/f/xblvelep', {
      method: 'POST', headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email })
    });
    if (r.ok) { msg.textContent = "You're in."; msg.style.color = '#4ECDC4'; e.target.email.value = ''; }
    else throw 0;
  } catch { msg.textContent = 'Try again.'; msg.style.color = '#FFA07A'; }
  setTimeout(() => msg.textContent = '', 4000);
};

// Keyboard
onkeydown = e => {
  if (e.key === 'Escape') {
    panel.classList.remove('open');
    modal.classList.remove('open');
  }
};

// Hint
setTimeout(() => document.getElementById('hint').classList.add('show'), 1200);
setTimeout(() => document.getElementById('hint').classList.remove('show'), 5000);

// Draw
function draw() {
  t += 0.012;
  if (auto) tRotY += 0.002;
  rotX += (tRotX - rotX) * 0.08;
  rotY += (tRotY - rotY) * 0.08;

  ctx.fillStyle = '#030305';
  ctx.fillRect(0, 0, W, H);

  // Stars
  for (const s of stars) {
    const p = proj(s.x, s.y, s.z);
    if (p.z > 0.5) {
      ctx.globalAlpha = Math.min(0.7, p.s / 60);
      ctx.fillStyle = '#fff';
      ctx.beginPath();
      ctx.arc(p.x, p.y, Math.max(0.6, s.s * p.s * 0.012), 0, Math.PI * 2);
      ctx.fill();
    }
  }
  ctx.globalAlpha = 1;

  // Project nodes
  const pn = nodes.map((n, i) => {
    const o = pos[i];
    const float = i ? Math.sin(t + i) * 0.02 : 0;
    return { ...proj(o.x, o.y + float, o.z), n, i };
  });

  // Connections
  const core = pn[0];
  for (let i = 1; i < pn.length; i++) {
    const p = pn[i];
    const g = ctx.createLinearGradient(core.x, core.y, p.x, p.y);
    g.addColorStop(0, 'rgba(78,205,196,0.18)');
    g.addColorStop(1, 'rgba(78,205,196,0.02)');
    ctx.strokeStyle = g;
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.moveTo(core.x, core.y);
    ctx.lineTo(p.x, p.y);
    ctx.stroke();
  }

  // Sort & draw
  pn.sort((a, b) => a.z - b.z);
  for (const p of pn) {
    const n = p.n;
    const r = Math.max(10, n.r * p.s * 0.7);
    const isCore = n.id === 'core';

    // Glow
    const gR = r * (isCore ? 2.5 : 1.8);
    const glow = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, gR);
    glow.addColorStop(0, `rgba(${n.color},${isCore ? 0.3 : 0.15})`);
    glow.addColorStop(1, 'transparent');
    ctx.fillStyle = glow;
    ctx.beginPath();
    ctx.arc(p.x, p.y, gR, 0, Math.PI * 2);
    ctx.fill();

    // Node
    const grad = ctx.createRadialGradient(p.x - r * 0.25, p.y - r * 0.25, 0, p.x, p.y, r);
    grad.addColorStop(0, `rgba(${n.color.map(c => Math.min(255, c + 40))},1)`);
    grad.addColorStop(1, `rgb(${n.color})`);
    ctx.fillStyle = grad;
    ctx.beginPath();
    ctx.arc(p.x, p.y, r, 0, Math.PI * 2);
    ctx.fill();

    // Label
    ctx.fillStyle = 'rgba(255,255,255,0.65)';
    ctx.font = `500 ${Math.max(10, r * 0.4)}px Inter`;
    ctx.textAlign = 'center';
    ctx.fillText(n.label, p.x, p.y + r + 16);
  }

  requestAnimationFrame(draw);
}
draw();
</script>

</body>
</html>
